INSERT INTO JOB_INSTANCES (
	ID,
	BATCH_ID,
	JOB_DATE,
	JOB_SEQ,
	JOB_TYPE,
	STAGE_CD,
	COM_CD,
	EQUIP_TYPE,
	EQUIP_GROUP_CD,
	EQUIP_CD,
	SUB_EQUIP_CD,
	IND_CD,
	COLOR_CD,
	CLASS_CD,
	BOX_CLASS_CD,
	SHOP_CD,
	SHOP_NM,
	CUST_ORDER_NO,
	ORDER_NO,
	INVOICE_ID,
	SKU_CD,
	SKU_BARCD,
	SKU_NM,
	BOX_IN_QTY,
	PICK_QTY,
	PICKING_QTY,
	PICKED_QTY,
	INSPECTED_QTY,
	ORDER_TYPE,
	STATUS,
	DOMAIN_ID,
	CREATOR_ID,
	UPDATER_ID,
	CREATED_AT,
	UPDATED_AT
)
SELECT
	uuid_generate_v4()::text ID,
	O.BATCH_ID,
	O.JOB_DATE,
	O.JOB_SEQ,
	O.JOB_TYPE,
	O.STAGE_CD,
	O.COM_CD,
	O.EQUIP_TYPE,
	O.EQUIP_GROUP_CD,
	O.EQUIP_CD,
	O.SUB_EQUIP_CD,
	C.IND_CD,
	C.IND_COLOR_CD AS COLOR_CD,
	O.CLASS_CD,
	O.BOX_CLASS_CD,
	MAX(O.SHOP_CD) AS SHOP_CD,
	MAX(O.SHOP_NM) AS SHOP_NM,
	MAX(O.CUST_ORDER_NO) AS CUST_ORDER_NO,
	MAX(O.ORDER_NO) AS ORDER_NO,
	O.INVOICE_ID,
	O.SKU_CD,
	MAX(O.SKU_BARCD) AS SKU_BARCD,
	MAX(O.SKU_NM) AS SKU_NM,
	MAX(O.BOX_IN_QTY) AS BOX_IN_QTY,
	SUM(O.ORDER_QTY) AS PICK_QTY,
	0 AS PICKING_QTY,
	0 AS PICKED_QTY,
	0 AS INSPECTED_QTY,
	MAX(O.ORDER_TYPE) AS ORDER_TYPE,
	'W',
	O.DOMAIN_ID,
	'system',
	'system',
	now(),
	now()
FROM
	ORDERS O
	LEFT OUTER JOIN
	CELLS C
	ON O.DOMAIN_ID = C.DOMAIN_ID AND O.EQUIP_TYPE = C.EQUIP_TYPE AND O.EQUIP_CD = C.EQUIP_CD AND O.SUB_EQUIP_CD = C.CELL_CD
WHERE
	O.DOMAIN_ID = :domainId
	AND O.BATCH_ID = :batchId
	#if($wmsBatchNo)
	AND O.WMS_BATCH_NO = :wmsBatchNo
	#end
GROUP BY
	O.DOMAIN_ID,
	O.BATCH_ID,
	O.JOB_DATE,
	O.JOB_SEQ,
	O.JOB_TYPE,
	O.STAGE_CD,
	O.COM_CD,
	O.EQUIP_TYPE,
	O.EQUIP_GROUP_CD,
	O.EQUIP_CD,
	O.SUB_EQUIP_CD,
	C.IND_CD,
	C.IND_COLOR_CD,
	O.CLASS_CD,
	O.BOX_CLASS_CD,
	O.SKU_CD,
	O.INVOICE_ID